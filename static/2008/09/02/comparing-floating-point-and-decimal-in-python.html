<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Comparing floating-point and decimal in Python &mdash; Martin Kleppmann&rsquo;s blog</title>
    <link rel="stylesheet" type="text/css" media="screen, print, handheld" href="/css/typography.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/pygments-default.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/ansi2html.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/customizations.css?3" />
<!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/ie.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/martinkl?format=xml" title="Martin Kleppmann's blog" />

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
<script src="http://downloads.mailchimp.com/js/jquery.form-n-validate.js" type="text/javascript"></script>
<script src="/form.js" type="text/javascript"></script>

</head>

<body class="wordpress">
    <div id="page">
        <p id="top">
    <a id="to-content" href="#content" title="Skip to content">Skip to content</a>
</p>

<div id="header">
    <div class="wrapper">
        <strong id="blog-title">
            <a href="/" title="Home" rel="home">Martin Kleppmann</a>
        </strong>
    </div>
</div>

<div id="sub-header">
    <div class="wrapper">
        <div id="navigation">
            <ul>
                <li class="page_item"><a href="/contact.html" title="About/Contact">About/Contact</a></li>
            </ul>
        </div>
    </div>
</div>

<hr class="divider">


        <div class="wrapper">
            <div id="content">
                <h1>Comparing floating-point and decimal in Python</h1>

                <p>Bizarre happenings in the world of Python. It seems that you are really not supposed to compare
floating-point and decimal numbers, as this example
shows:</p>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="go">Python 2.5.1 (r251:54863, Jan 17 2008, 19:35:17)</span>
<span class="go">[GCC 4.0.1 (Apple Inc. build 5465)] on darwin</span>
<span class="go">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span>
<span class="go">True</span></code></pre></div>

<p>But that’s not the end yet. I have
<a href="http://nltk.sourceforge.net/">NLTK</a> 0.9.4 installed, and watch how truth is reversed if I simply
import the NLTK package:</p>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nltk</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.0</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;1.0&#39;</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">2.0</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;3.0&#39;</span><span class="p">)</span>
<span class="go">False</span></code></pre></div>

<p>I’m filing bugs about this, but I do find this quite entertaining in a
‘oh-my-God-I-always-believed-Python-was-a-well-behaved-language’ sort of way.</p>

<p><strong>Edit:</strong> Edward Loper from NLTK gave
<a href="https://sourceforge.net/tracker/?func=detail&amp;atid=400896&amp;aid=2089412&amp;group_id=30982">an explanation</a>
why this is the case – it’s not because of NLTK, but because of Python’s internal handling of the
comparison operator on floating-point
numbers:</p>

<blockquote>Apparently, you're only allowed to use comparison operators to compare
<code>Decimal</code> objects to (i) other
<code>Decimal</code> objects; (ii) integers; (iii) longs. Here, you're comparing it to a
<code>float</code>, which isn't allowed, as evidenced by the
following:</blockquote>

<div class="highlight"><pre><code class="language-pycon" data-lang="pycon"><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;.1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;.1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">__cmp__</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">)</span>
<span class="go">NotImplemented</span></code></pre></div>

<blockquote><p>Since Decimal's
<code>__cmp__</code> method returns
<code>NotImplemented</code>, python falls back on using
<code>.3</code>'s
<code>__cmp__</code> method.  Unfortunately, when you compare a
<code>float</code> to some random object, the results are pretty much arbitrary, and are not
guaranteed to be consistent. [...]</p>

<p>nltk's not really playing much of a role here (other than
tweaking the system to change that arbitrary result -- my guess would be that the result depends on
the pointer address of the
<code>Decimal</code> class, or of some other object like that).</p></blockquote>

<p>Crazy stuff.</p>


                

                <div id="disqus_thread"></div>
            </div>

            <div id="sidebar">
                <div id="carrington-subscribe" class="widget">
    <h2 class="widget-title">Subscribe</h2>
    <a class="feed" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/martinkl">
        Site <acronym title="Really Simple Syndication">RSS</acronym> feed
    </a>

    <div id="mc_embed_signup">
        <p>
            Enjoyed this? To get notified when I write something new,
            <a href="http://twitter.com/martinkl">follow me</a> on Twitter,
            <a href="http://feeds.feedburner.com/martinkl">subscribe</a> to the RSS feed,
            or type in your email address:
        </p>

        <form action="http://rapportive.us2.list-manage.com/subscribe/post?u=9a1adaf549282981a96e171d1&amp;id=4543b695f6"
            method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
            <fieldset>
                <div class="mc-field-group">
                    <label for="mce-EMAIL">Email:</label>
                    <input type="text" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn">
                </div>
                <div id="mce-responses">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>
            </fieldset>
        </form>

        <p class="disclaimer">
            I won't give your address to anyone else, won't send you any spam, and you can unsubscribe at any time.
        </p>
    </div>
</div>

<div id="primary-sidebar">
    <div id="book-promo" class="widget">
        <h2 class="title">My book</h2>
        <p><a href="http://www.anrdoezrs.net/click-7658334-11260198?url=http%3A%2F%2Fshop.oreilly.com%2Fproduct%2F0636920032175.do%3Fcmp%3Daf-strata-books-videos-product_cj_9781491903094_%2525zp&cjsku=0636920032175" target="_top"><img src="http://akamaicovers.oreilly.com/images/0636920032175/cat.gif" border="0" alt="Designing Data-Intensive Applications"/></a></p>
        <p>I'm writing a book for O'Reilly, called
        <a href="http://dataintensive.net">Designing Data-Intensive Applications</a>.</p>
    </div>
</div>

                


<div id="secondary-sidebar">
    <div class="widget">
        <h2 class="title">Recent posts</h2>
        <ul>
            
              <li>10 Dec 2014: <a href="/2014/12/10/build-your-own-google.html">Wouldn’t it be fun to build your own Google?</a></li>
            
              <li>25 Nov 2014: <a href="/2014/11/25/hermitage-testing-the-i-in-acid.html">Hermitage: Testing the “I” in ACID</a></li>
            
              <li>15 Sep 2014: <a href="/2014/09/15/writing-a-book.html">Hey, I'm writing a book!</a></li>
            
              <li>28 Aug 2014: <a href="/2014/08/28/upcoming-conference-talks-about-samza.html">Upcoming conference talks about Samza</a></li>
            
              <li>26 Mar 2014: <a href="/2014/03/26/six-things-about-scaling.html">Six things I wish we had known about scaling</a></li>
            
            <li><a href="/archive.html">Full archive</a></li>
        </ul>
    </div>

    <div class="widget">
        <h2 class="title">Conference talks</h2>
        <ul>
            
              <li><a href="/2015/02/03/samza-at-jfokus.html">03 Feb 2015 at Jfokus</a></li>
            
              <li><a href="/2015/01/31/searching-over-streams-at-fosdem.html">31 Jan 2015 at FOSDEM (Open Source Search Room)</a></li>
            
              <li><a href="/2015/01/24/stream-processing-at-dev-winter.html">24 Jan 2015 at /dev/winter</a></li>
            
              <li><a href="/2014/12/02/samza-at-unified-log-london.html">02 Dec 2014 at Unified Log London</a></li>
            
              <li><a href="/2014/11/18/scalable-stream-processing-at-apachecon.html">18 Nov 2014 at ApacheCon Europe</a></li>
            
            <li><a href="/talks.html">Full archive</a></li>
        </ul>
    </div>
</div>

            </div>
        </div>

        <hr class="divider" />

<div id="footer">
    <div class="wrapper">
        <p id="generator-link">
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"
                style="float: left; padding: 0.3em 1em 0 0;"><img alt="Creative Commons License"
                src="http://i.creativecommons.org/l/by/3.0/88x31.png" /></a>
            Unless otherwise specified, all content on this site is licensed under a
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
                Attribution 3.0 Unported License</a>.
            Theme borrowed from
            <span id="theme-link"><a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a></span>,
            ported to <a href="https://github.com/mojombo/jekyll">Jekyll</a> by Martin Kleppmann.
        </p>
    </div>
</div>

<img src="http://www.lduhtrp.net/image-7658334-11260198" width="1" height="1" border="0"/>

    </div>

    <script type="text/javascript">
    var disqus_shortname = 'martinkl';
    var disqus_url = 'http://martin.kleppmann.com/2008/09/02/comparing-floating-point-and-decimal-in-python.html';
    var disqus_identifier = disqus_url;

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-7958895-1");
        pageTracker._trackPageview();
    } catch (err) {}
</script>

</body>
</html>
