<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Ubuntu upgrade woes &mdash; Martin Kleppmann&lsquo;s blog</title>
    <link rel="stylesheet" type="text/css" media="screen, print, handheld" href="/css/typography.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/pygments-default.css" />
<!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/ie.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

</head>

<body class="wordpress">
    <div id="page">
        <p id="top">
    <a id="to-content" href="#content" title="Skip to content">Skip to content</a>
</p>

<div id="header">
    <div class="wrapper">
        <strong id="blog-title">
            <a href="/" title="Home" rel="home">Martin Kleppmann</a>
        </strong>
        <p id="blog-description">Entrepreneurship, web technology and the user experience</p>
    </div>
</div>

<div id="sub-header">
    <div class="wrapper">
        <div id="navigation">
            <ul>
                <li class="page_item"><a href="/contact.html" title="Contact/Copyright">Contact/Copyright</a></li>
            </ul>
        </div>
    </div>
</div>

<hr class="divider">

<div class="wrapper">

        <div id="content">
            <h1>Ubuntu upgrade woes</h1>
            <p>This page has been offline for the last 24 hours because I messed up the server on which it was running (now I&#8217;ve moved it to another one). I officially <strong>hate</strong> system maintenance&#8230;</p>

<p>The server was running Ubuntu Feisty (7.04) which is now getting a bit old and gradually coming towards the end of its support lifetime. An upgrade would be necessary before too long anyway, so I decided to try updating it using the <a href='http://www.howtoforge.com/upgrade-ubuntu-7.04-server-to-7.10'>do-release-upgrade</a> tool. My setup is pretty sane, using only standard packages, so I thought the tool would be able to handle the upgrade smoothly.</p>

<p>Unfortunately, no. At some point during the configuration of the new packages, dpkg started dying by segmentation fault, and from there on everything just went downhill. In the end I had a system with dozens of broken packages (and no way of fixing them with dpkg segfaulting), and quite a few daemons dying similarly. Probably some important shared library got replaced with an incompatible version &#8211; rubbish! Apache, MySQL and OpenVPN were dead, and I set them up on a new server; fortunately, Bind, Postfix and Dovecot somehow survived, so at least our emails are still getting through, and I could point the domain names to the new server&#8217;s IP address. Still, bloody annoying.</p>

<p>Why is server configuration and maintenance such a crap activity? What I really want is a sort of version control system for installed packages and configuration file changes. My wish list:</p>

<ul>
<li>The version control should save only modifications to config files (differences from the package maintainers&#8217; versions) so that the same modifications can be merged into the configuration files for a new version of the packages. This also makes the setup more maintainable, because it is easier for one admin to see the configuration changes made by another admin. Elementary software engineering stuff really.</li>

<li>I want to be able to generate a functionally identical system by taking a barebones install, applying the package installations and config file changes from version control, and copying in the contents of /home and /var/lib. Then I would never ever do an upgrade to a new release of the distribution; instead I would do a fresh install of the new release, configure it like the old one, test it thoroughly to make sure that it works, synchronise the contents, and switch them over in an instant. MUCH less stressful and error-prone.</li>

<li>It should still be possible to edit the server&#8217;s config files like on any other, since all sorts of changes need to be made in day-to-day operation; such changes should be checked into the version control so that they are recorded and documented.</li>
</ul>

<p>I have already built myself a tool for generating <a href='http://aws.amazon.com/ec2'>Amazon EC2</a> images &#8211; effectively a few Python and Shell scripts which take a barebones install and configure it completely for a particular application; I keep these scripts in version control so the build process is completely transparent and reproducible. However, if I make any modification to the image by hand, I need to remember to enter the same changes into the scripts, so that they still correctly reflect the build process. Really what I want is that manual step to go away.</p>

<p>I&#8217;m thinking that it oughtn&#8217;t be too hard to build such a system configuration management framework by putting /etc in a standard version control system, recording changes elsewhere in the filesystem, and making clever wrappers for a few standard maintenance tools such as apt-get (which just remembers somewhere which packages have been installed). Has nobody built something like that yet?</p>

            <div id="disqus_thread"></div>
        </div>
            <div id="sidebar">
        <div id="carrington-about" class="widget">
            <div class="about">
                <h2 class="title">About Martin Kleppmann</h2>

                <p>Hello! I'm Martin Kleppmann, entrepreneur and software craftsman in
                <a href="http://en.wikipedia.org/wiki/San_Francisco">San Francisco</a> (previously in
                <a href="http://en.wikipedia.org/wiki/Cambridge">Cambridge, UK</a>). I care about
                making stuff that people want, great people and culture, the web and its future,
                marvellous user experiences, maintainable code and scalable architecture.</p>

                <p>I am co-founder of <a href="http://rapportive.com/">Rapportive</a>, together with
                <a href="http://www.samstokes.co.uk/">Sam Stokes</a> and
                <a href="http://twitter.com/rahulvohra">Rahul Vohra</a>. We make a nifty tool which
                gives you profiles about your contacts right inside Gmail. Previously I founded Go Test It
                (<a href="http://go-test.it/blog/2009/11/30/red-gate-acquires-go-test-it.html">acquired</a> by
                <a href="http://www.red-gate.com/">Red Gate Software</a> in 2009).</p>

                <p>I'd love to hear from you, so please leave comments, or feel free to
                <a href="/contact.html">contact me directly</a>.</p>
            </div>
        </div>


        <div id="primary-sidebar">
        </div>

        <div id="secondary-sidebar">
            <div id="carrington-archives" class="widget">
                <h2 class="title">Recent posts</h2>
                <ul>
                    
                      <li>21 Dec 2010: <a href="/2010/12/21/i-didnt-really-enjoy-y-combinator.html">I didn't really enjoy Y Combinator</a></li>
                    
                      <li>30 Oct 2010: <a href="/2010/10/30/intuition-has-no-transfer-encoding.html">Intuition has no transfer encoding</a></li>
                    
                      <li>31 Aug 2010: <a href="/2010/08/31/good-things-are-hard-to-articulate.html">Good things are hard to articulate</a></li>
                    
                      <li>05 May 2010: <a href="/2010/05/05/valuation-caps-on-convertible-notes-explained-with-graphs.html">Valuation caps on convertible notes, explained with graphs</a></li>
                    
                      <li>09 Apr 2010: <a href="/2010/04/09/our-social-future.html">Our social future</a></li>
                    
                    <li><a href="/archive.html">Full archive</a></li>
                </ul>
            </div>
        </div>
    </div>
</div> <!-- div.wrapper, started in 'before.html' -->

<hr class="divider" />

<div id="footer">
    <div class="wrapper">        
        <p id="generator-link">
            Theme borrowed from
            <span id="theme-link"><a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a></span>,
            ported to Jekyll by Martin Kleppmann.
        </p>
    </div>
</div>

    </div>

    <script type="text/javascript">
        var disqus_shortname = 'martinkl';
        var disqus_url = 'http://martin.kleppmann.com/2008/07/26/ubuntu-upgrade-woes.html';
        var disqus_identifier = disqus_url;

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-7958895-1");
        pageTracker._trackPageview();
    } catch (err) {}
</script>

</body>
</html>
