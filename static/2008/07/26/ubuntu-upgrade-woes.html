<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Ubuntu upgrade woes &mdash; Martin Kleppmann&rsquo;s blog</title>
    <link rel="stylesheet" type="text/css" media="screen, print, handheld" href="/css/typography.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/pygments-default.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/ansi2html.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/customizations.css?3" />
<!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/ie.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/martinkl?format=xml" title="Martin Kleppmann's blog" />

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
<script src="http://downloads.mailchimp.com/js/jquery.form-n-validate.js" type="text/javascript"></script>
<script src="/form.js" type="text/javascript"></script>

</head>

<body class="wordpress">
    <div id="page">
        <p id="top">
    <a id="to-content" href="#content" title="Skip to content">Skip to content</a>
</p>

<div id="header">
    <div class="wrapper">
        <strong id="blog-title">
            <a href="/" title="Home" rel="home">Martin Kleppmann</a>
        </strong>
        <p id="blog-description">Entrepreneurship, web technology and the user experience</p>
    </div>
</div>

<div id="sub-header">
    <div class="wrapper">
        <div id="navigation">
            <ul>
                <li class="page_item"><a href="/contact.html" title="About/Contact">About/Contact</a></li>
            </ul>
        </div>
    </div>
</div>

<hr class="divider">

<div class="wrapper">

        <div id="content">
            <h1>Ubuntu upgrade woes</h1>

            <p>This page has been offline for the last 24 hours because I messed up the server on which it was running (now I’ve moved it to another one). I officially <strong>hate</strong> system maintenance</p>

<p>The server was running Ubuntu Feisty (7.04) which is now getting a bit old and gradually coming towards the end of its support lifetime. An upgrade would be necessary before too long anyway, so I decided to try updating it using the <a href="http://www.howtoforge.com/upgrade-ubuntu-7.04-server-to-7.10">do-release-upgrade</a> tool. My setup is pretty sane, using only standard packages, so I thought the tool would be able to handle the upgrade smoothly.</p>

<p>Unfortunately, no. At some point during the configuration of the new packages, dpkg started dying by segmentation fault, and from there on everything just went downhill. In the end I had a system with dozens of broken packages (and no way of fixing them with dpkg segfaulting), and quite a few daemons dying similarly. Probably some important shared library got replaced with an incompatible version – rubbish! Apache, MySQL and OpenVPN were dead, and I set them up on a new server; fortunately, Bind, Postfix and Dovecot somehow survived, so at least our emails are still getting through, and I could point the domain names to the new server’s IP address. Still, bloody annoying.</p>

<p>Why is server configuration and maintenance such a crap activity? What I really want is a sort of version control system for installed packages and configuration file changes. My wish list:</p>

<ul>
<li>The version control should save only modifications to config files (differences from the package maintainers’ versions) so that the same modifications can be merged into the configuration files for a new version of the packages. This also makes the setup more maintainable, because it is easier for one admin to see the configuration changes made by another admin. Elementary software engineering stuff really.</li>

<li>I want to be able to generate a functionally identical system by taking a barebones install, applying the package installations and config file changes from version control, and copying in the contents of /home and /var/lib. Then I would never ever do an upgrade to a new release of the distribution; instead I would do a fresh install of the new release, configure it like the old one, test it thoroughly to make sure that it works, synchronise the contents, and switch them over in an instant. MUCH less stressful and error-prone.</li>

<li>It should still be possible to edit the server’s config files like on any other, since all sorts of changes need to be made in day-to-day operation; such changes should be checked into the version control so that they are recorded and documented.</li>
</ul>

<p>I have already built myself a tool for generating <a href="http://aws.amazon.com/ec2">Amazon EC2</a> images – effectively a few Python and Shell scripts which take a barebones install and configure it completely for a particular application; I keep these scripts in version control so the build process is completely transparent and reproducible. However, if I make any modification to the image by hand, I need to remember to enter the same changes into the scripts, so that they still correctly reflect the build process. Really what I want is that manual step to go away.</p>

<p>I’m thinking that it oughtn’t be too hard to build such a system configuration management framework by putting /etc in a standard version control system, recording changes elsewhere in the filesystem, and making clever wrappers for a few standard maintenance tools such as apt-get (which just remembers somewhere which packages have been installed). Has nobody built something like that yet?</p>

            

            <div id="disqus_thread"></div>
        </div>
            <div id="sidebar">
        <div id="carrington-subscribe" class="widget">
            <h2 class="widget-title">Subscribe</h2>
            <a class="feed" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/martinkl">
                Site <acronym title="Really Simple Syndication">RSS</acronym> feed
            </a>

            <div id="mc_embed_signup">
                <p>
                    Enjoyed this? To get notified when I write something new,
                    <a href="http://twitter.com/martinkl">follow me</a> on Twitter,
                    <a href="http://feeds.feedburner.com/martinkl">subscribe</a> to the RSS feed,
                    or type in your email address:
                </p>

                <form action="http://rapportive.us2.list-manage.com/subscribe/post?u=9a1adaf549282981a96e171d1&amp;id=4543b695f6"
                    method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
                    <fieldset>
                        <div class="mc-field-group">
                            <label for="mce-EMAIL">Email:</label>
                            <input type="text" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                            <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="btn">
                        </div>
                        <div id="mce-responses">
                            <div class="response" id="mce-error-response" style="display:none"></div>
                            <div class="response" id="mce-success-response" style="display:none"></div>
                        </div>
                    </fieldset>
                </form>

                <p class="disclaimer">
                    I won't give your address to anyone else, won't send you any spam, and you can unsubscribe at any time.
                </p>
            </div>
        </div>

        <div id="carrington-about" class="widget">
            <div class="about">
                <h2 class="title">About</h2>

                <p>Hello! I'm Martin Kleppmann, entrepreneur and software craftsman.
                I co-founded <a href="http://rapportive.com/">Rapportive</a>
                (<a href="http://blog.rapportive.com/rapportive-acquired-by-linkedin">acquired</a>
                by <a href="http://www.linkedin.com/">LinkedIn</a> in 2012) and Go Test It (acquired by 
                <a href="http://www.red-gate.com/">Red Gate Software</a> in 2009).</p>

                <p>I care about making stuff that people want, great people and culture, the web and
                its future, marvellous user experiences, maintainable code and scalable architectures.</p>

                <p>I'd love to hear from you, so please leave comments, or feel free to
                <a rel="author" href="/contact.html">contact me directly</a>.</p>
            </div>
        </div>

        <div id="primary-sidebar">
            <div id="book-promo" class="widget">
                <h2 class="title">My book</h2>
                <p><a href="http://www.anrdoezrs.net/click-7658334-11260198?url=http%3A%2F%2Fshop.oreilly.com%2Fproduct%2F0636920032175.do%3Fcmp%3Daf-strata-books-videos-product_cj_9781491903094_%2525zp&cjsku=0636920032175" target="_top"><img src="http://akamaicovers.oreilly.com/images/0636920032175/cat.gif" border="0" alt="Designing Data-Intensive Applications"/></a></p>
                <p>I'm writing a book for O'Reilly, called
                <a href="http://dataintensive.net">Designing Data-Intensive Applications</a>.</p>
                <img src="http://www.lduhtrp.net/image-7658334-11260198" width="1" height="1" border="0"/>
            </div>
        </div>

        <div id="secondary-sidebar">
            <div id="carrington-archives" class="widget">
                <h2 class="title">Recent posts</h2>
                <ul>
                    
                      <li>15 Sep 2014: <a href="/2014/09/15/writing-a-book.html">Hey, I'm writing a book!</a></li>
                    
                      <li>28 Aug 2014: <a href="/2014/08/28/upcoming-conference-talks-about-samza.html">Upcoming conference talks about Samza</a></li>
                    
                      <li>26 Mar 2014: <a href="/2014/03/26/six-things-about-scaling.html">Six things I wish we had known about scaling</a></li>
                    
                      <li>23 Oct 2013: <a href="/2013/10/23/linkedin-intro-doing-the-impossible-on-ios.html">LinkedIn Intro: Doing the Impossible on iOS</a></li>
                    
                      <li>12 Aug 2013: <a href="/2013/08/12/system-operations-over-seven-centuries.html">System operations over seven centuries</a></li>
                    
                    <li><a href="/archive.html">Full archive</a></li>
                </ul>
            </div>
        </div>
    </div>
</div> <!-- div.wrapper, started in 'before.html' -->

<hr class="divider" />

<div id="footer">
    <div class="wrapper">
        <p id="generator-link">
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"
                style="float: left; padding: 0.3em 1em 0 0;"><img alt="Creative Commons License"
                src="http://i.creativecommons.org/l/by/3.0/88x31.png" /></a>
            Unless otherwise specified, all content on this site is licensed under a
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
                Attribution 3.0 Unported License</a>.
            Theme borrowed from
            <span id="theme-link"><a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a></span>,
            ported to <a href="https://github.com/mojombo/jekyll">Jekyll</a> by Martin Kleppmann.
        </p>
    </div>
</div>

    </div>

    <script type="text/javascript">
        var disqus_shortname = 'martinkl';
        var disqus_url = 'http://martin.kleppmann.com/2008/07/26/ubuntu-upgrade-woes.html';
        var disqus_identifier = disqus_url;

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-7958895-1");
        pageTracker._trackPageview();
    } catch (err) {}
</script>

</body>
</html>
