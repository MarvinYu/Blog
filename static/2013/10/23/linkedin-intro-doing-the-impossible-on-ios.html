<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head profile="http://gmpg.org/xfn/11">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>LinkedIn Intro: Doing the Impossible on iOS &mdash; Martin Kleppmann&rsquo;s blog</title>
    <link rel="stylesheet" type="text/css" media="screen, print, handheld" href="/css/typography.css" />
<link rel="stylesheet" type="text/css" media="screen" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/pygments-default.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/ansi2html.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/customizations.css?4" />
<!--[if lt IE 8]>
    <link rel="stylesheet" href="/css/ie.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/martinkl?format=xml" title="Martin Kleppmann's blog" />

</head>

<body class="wordpress">
    <div id="page">
        <p id="top">
    <a id="to-content" href="#content" title="Skip to content">Skip to content</a>
</p>

<div id="header">
    <div class="wrapper">
        <strong id="blog-title">
            <a href="/" title="Home" rel="home">Martin Kleppmann</a>
        </strong>
    </div>
</div>

<div id="sub-header">
    <div class="wrapper">
        <div id="navigation">
            <ul>
                <li class="page_item"><a href="/contact.html" title="About/Contact">About/Contact</a></li>
            </ul>
        </div>
    </div>
</div>

<hr class="divider">


        <div class="wrapper">
            <div id="content">
                <a class="twitter-share-button" href="https://twitter.com/share" data-text="LinkedIn Intro: Doing the Impossible on iOS"
                    data-via="martinkl" data-related="martinkl" data-size="large" data-count="none">Tweet</a>

                <h1>LinkedIn Intro: Doing the Impossible on iOS</h1>

                <p><em>This is a copy of a post I originally wrote on the
<a href="http://engineering.linkedin.com/mobile/linkedin-intro-doing-impossible-ios">LinkedIn engineering blog</a>.</em></p>

<p>We recently launched <a href="https://intro.linkedin.com/">LinkedIn Intro</a> — a new product that shows you
LinkedIn profiles, <em>right inside the native iPhone mail client</em>. That’s right: we have extended
Apple’s built-in iOS Mail app, a feat that many people consider to be impossible. This post is
a short summary of how Intro works, and some of the ways we bent technology to our will.</p>

<p>With Intro, you can see at a glance the picture of the person who’s emailing you, learn more about
their background, and connect with them on LinkedIn. This is what it looks like:</p>

<p style="text-align: center; font-style: italic; color: #666; font-size: 85%;">
<img src="/2013/10/intro_before_after.png" width="550" alt="The iPhone mail app, before and after Intro" />
<br />The iPhone mail app, before and after Intro</p>

<h2 id="how-intro-came-to-be">How Intro Came to Be</h2>

<p>The origins of Intro go back to before the acquisition of <a href="http://rapportive.com/">Rapportive</a> by
LinkedIn. At Rapportive, we had built a browser extension that modified Gmail to show the profile of
an email’s sender within the Gmail page. The product was popular, but people kept asking: “I love
Rapportive in Gmail, when can I have it on mobile too?”</p>

<p>The magic of Rapportive is that you don’t have to remember to use it. Once you have it installed, it
is right there inside your email, showing you everything you need to know about your contacts. You
don’t need to fire up a new app or do a search in another browser tab, because the information is
right there when you need it. It just feels natural.</p>

<p>At LinkedIn, we want to <a href="http://www.youtube.com/watch?v=t6SdSqI0JR0">work wherever our members work</a>.
And we know that professionals spend a lot of time on their phone, checking and replying to emails
— so we had to figure out how to enhance mobile email, giving professionals the information they
need to be brilliant with people.</p>

<p>But how do we do that? Ask any iOS engineer: there is no API for extending the built-in mail app on
the iPhone. If you wanted to build something like Rapportive, most people would tell you that it is
impossible. Yet we figured it out.</p>

<h2 id="impossible-1-extending-the-ios-mail-client">Impossible #1: Extending the iOS Mail Client</h2>

<p>Our key insight was this: we cannot extend the mail client, but we can add information to the
messages themselves. One way to do this would be to modify the messages on the server — but then the
modification would appear on all your clients, both desktop and mobile. That would not be what users
want.</p>

<p>Instead, we can add information to messages by using a proxy server.</p>

<p style="text-align: center; font-style: italic; color: #666; font-size: 85%;">
<img src="/2013/10/intro_imap_proxy.png" width="550" alt="Rewriting messages using an IMAP proxy" />
<br />Rewriting messages using an IMAP proxy</p>

<p>Normally your device connects directly to the servers of your email provider (Gmail, Yahoo, AOL,
etc.), but we can configure the device to connect to the Intro proxy server instead.</p>

<p>The Intro proxy server speaks the <a href="http://tools.ietf.org/html/rfc3501">IMAP</a> protocol just like an
email provider, but it doesn’t store messages itself. Instead, it forwards requests from the device
to your email provider, and forwards responses from the email provider back to the device. En route,
it inserts Intro information at the beginning of each message body — we call this the top bar.</p>

<p>The great thing about this approach: the proxy server can tailor the top bar to the device, since it
knows which device is downloading the message. It can adapt the layout to be appropriate to the
screen size, and it can take advantage of the client’s latest features, because it doesn’t need to
worry about compatibility with other devices.</p>

<p>Our proxy server is written in Ruby using EventMachine, which allows it to efficiently handle many
concurrent IMAP connections. We have developed some libraries to make the evented programming model
nicer to work with, including
<a href="https://github.com/samstokes/deferrable_gratification">Deferrable Gratification</a> and
<a href="https://github.com/ConradIrwin/lspace">LSpace</a>.</p>

<h2 id="impossible-2-interactive-ui-in-email">Impossible #2: Interactive UI in Email</h2>

<p>Ok, we have a way of adding information about the sender to a message — but so far it’s just
a static piece of HTML. The top bar is deliberately minimal, because we don’t want it to get in the
way. But wouldn’t it be <em>awesome</em> if you could tap the top bar and see the full LinkedIn profile…
without leaving the mail app?</p>

<p>“But that’s impossible,” they cry, “you can’t run JavaScript in the mail client!” And that’s true
— any JavaScript in an email is simply ignored. But iOS Mail does have powerful CSS capabilities,
since it uses the same rendering engine as Safari.</p>

<p>Recall that CSS has a <code>:hover</code> state that is triggered when you hover the mouse over an element.
This is used for popup menus in the navigation of many websites, or for tooltips. But what do you do
on a touchscreen device, where there is no hovering or clicking, only tapping?</p>

<p>A little-known fact about CSS on Mobile Safari: in certain circumstances, tapping a link once
simulates a <code>:hover</code> state on that link, and tapping it twice has the effect of a click. Thanks to
this feature, popup menus and tooltips still work on iOS.</p>

<p>With some creativity, we figured out how to use this effect to create an interactive user interface
<em>within</em> a message! Just tap the top bar to see the full LinkedIn profile:</p>

<p style="text-align: center; font-style: italic; color: #666; font-size: 85%;">
<img src="/2013/10/intro_drawer.png" width="550" alt="With CSS tricks we can embed an entire LinkedIn profile in a message" />
<br />With CSS tricks we can embed an entire LinkedIn profile in a message</p>

<h2 id="impossible-3-dynamic-content-in-email">Impossible #3: Dynamic Content in Email</h2>

<p>This <code>:hover</code> trick allows us to have some interactivity within a message, but for more complex
interactions we have to take you to the browser (where we can run a normal web app, without the mail
app’s limitations). For example, if you want to connect with your contact on LinkedIn, we take you
to Safari.</p>

<p>That’s fine, but it leaves us with a problem: the top bar needs to show if you’re already connected
with someone. Say you send an invitation, and the other person accepts — now you’re connected, but
if you open the same email again, it still says that you’re not connected!</p>

<p>This is because once a message has been downloaded, an IMAP client may assume that the message will
never change. It is cached on the device, and unlike a web page, it never gets refreshed. Now that
you’re connected, the top bar content needs to change. How do we update it?</p>

<p>Our solution: the connect button is in a tiny <code>&amp;lt;iframe&amp;gt;</code> which is refreshed every time you
open the message. And if you open the message while your device is offline? No problem: the <code>iframe</code>
is positioned on top of an identical-looking button in the static top bar HTML. If the <code>iframe</code>
fails to load, it simply falls back to the connection status at the time when the message was
downloaded.</p>

<p>This allows the top bar to contain dynamic content, even though it’s impossible for the server to modify a message once it has been downloaded by the device.</p>

<p style="text-align: center; font-style: italic; color: #666; font-size: 85%;">
<img src="/2013/10/intro_connection_status.png" width="550" alt="Using an embedded iframe to keep the connection status up-to-date, within an otherwise static top bar" />
<br />Using an embedded iframe to keep the connection status up-to-date, within an otherwise static top bar</p>

<h2 id="impossible-4-easy-installation">Impossible #4: Easy Installation</h2>

<p>Once we got the IMAP proxy working, we were faced with another problem: how do we configure a device
to use the proxy? We cannot expect users to manually enter IMAP and SMTP hostnames, choose the
correct TLS settings, etc — it’s too tedious and error-prone.</p>

<p>Fortunately, Apple provides a friendly way of setting up email accounts by using
<a href="https://developer.apple.com/library/ios/featuredarticles/iPhoneConfigurationProfileRef/">configuration profiles</a>
— a facility that is often used in enterprise deployments of iOS devices. Using this technique, we
can simply ask the user for their email address and password, autodiscover the email provider
settings, and send a configuration profile to the device. The user just needs to tap “ok” a few
times, and then they have a new mail account.</p>

<p>Moreover, for Gmail and Google Apps accounts, we can use OAuth, and never need to ask for the user’s password. Even better!</p>

<p style="text-align: center; font-style: italic; color: #666; font-size: 85%;">
<img src="/2013/10/intro_installer_0.png" width="550" alt="iOS configuration profiles make setup of new email accounts a breeze" />
<br />iOS configuration profiles make setup of new email accounts a breeze</p>

<h2 id="security-and-privacy">Security and Privacy</h2>

<p>We understand that operating an email proxy server carries great responsibility. We respect the fact
that your email may contain very personal or sensitive information, and we will do everything we can
to make sure that it is safe. Our principles and key security measures are detailed in our
<a href="https://intro.linkedin.com/micro/privacy">pledge of privacy</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>When we first built Rapportive for Gmail, people thought that we were crazy — writing a browser
extension that modified the Gmail page on the fly, effectively writing an application inside someone
else’s application! But it turned out to be a great success, and many others have since followed our
footsteps and written browser extensions for Gmail.</p>

<p>Similarly, Intro’s approach of proxying IMAP is a novel way of delivering software to users. It
operates at the limit of what is technically possible, but it has a big advantage: we can enhance
the apps you already use. Of course the idea isn’t limited to the iPhone, so watch out for new
platforms coming your way soon :)</p>

<p>This post has only scratched the surface of the interesting challenges we have overcome while
building Intro. In follow-up posts we will talk about some of our CSS techniques, testing and
monitoring tools, things we do to achieve high performance and high reliability, and more. In the
meantime, check out <a href="https://intro.linkedin.com/">Intro</a> and let us know what you think!</p>


                

                <div id="disqus_thread"></div>
            </div>

            <div id="sidebar">
                <div id="carrington-subscribe" class="widget">
    <h2 class="widget-title">Subscribe</h2>
    <a class="feed" title="RSS 2.0 feed for posts" rel="alternate" href="http://feeds.feedburner.com/martinkl">
        Site <acronym title="Really Simple Syndication">RSS</acronym> feed
    </a>

    <div id="mc_embed_signup">
        <p>
            To get notified when I write something new,
            <a href="https://twitter.com/martinkl">follow me</a> on Twitter,
            <a href="http://feeds.feedburner.com/martinkl">subscribe</a> to the RSS feed,
            or enter your email address:
        </p>

        <form action="//kleppmann.us2.list-manage.com/subscribe/post?u=9a1adaf549282981a96e171d1&amp;id=4543b695f6"
            method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
            <fieldset>
                <div class="mc-field-group">
                    <label for="mce-EMAIL">Email address:</label>
                    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                    <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
                </div>
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_9a1adaf549282981a96e171d1_4543b695f6" tabindex="-1" value=""></div>
            </fieldset>
        </form>

        <p class="disclaimer">
            I won't give your address to anyone else, won't send you any spam, and you can unsubscribe at any time.
        </p>
    </div>
</div>

<div id="primary-sidebar">
    <div id="book-promo" class="widget">
        <h2 class="title">My book</h2>
        <p><a href="http://www.anrdoezrs.net/click-7658334-11260198?url=http%3A%2F%2Fshop.oreilly.com%2Fproduct%2F0636920032175.do%3Fcmp%3Daf-strata-books-videos-product_cj_9781491903094_%2525zp&cjsku=0636920032175" target="_top"><img src="/images/book-cover-small.png" border="0" alt="Designing Data-Intensive Applications" width="180" height="236"/></a></p>
        <p>I'm writing a book for O'Reilly, called
        <a href="http://dataintensive.net">Designing Data-Intensive Applications</a>.</p>
    </div>

    <div id="tweets" class="widget">
        <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/martinkl" data-widget-id="557543934298423296">Tweets by @martinkl</a>
    </div>
</div>

                


<div id="secondary-sidebar">
    <div class="widget">
        <h2 class="title">Recent posts</h2>
        <ul>
            
              <li>27 May 2015: <a href="/2015/05/27/logs-for-data-infrastructure.html">Using logs to build a solid data infrastructure (or: why dual writes are a bad idea)</a></li>
            
              <li>11 May 2015: <a href="/2015/05/11/please-stop-calling-databases-cp-or-ap.html">Please stop calling databases CP or AP</a></li>
            
              <li>23 Apr 2015: <a href="/2015/04/23/bottled-water-real-time-postgresql-kafka.html">Bottled Water: Real-time integration of PostgreSQL and Kafka</a></li>
            
              <li>13 Apr 2015: <a href="/2015/04/13/real-time-full-text-search-luwak-samza.html">Real-time full-text search with Luwak and Samza</a></li>
            
              <li>04 Mar 2015: <a href="/2015/03/04/turning-the-database-inside-out.html">Turning the database inside-out with Apache Samza</a></li>
            
            <li><a href="/archive.html">Full archive</a></li>
        </ul>
    </div>

    <div class="widget">
        <h2 class="title">Conference talks</h2>
        <ul>
            
              <li><a href="/2015/11/06/streams-as-team-interface-at-oredev.html">06 Nov 2015 at Øredev</a></li>
            
              <li><a href="/2015/11/03/streams-crdts-databases-at-code-mesh.html">03 Nov 2015 at Code Mesh</a></li>
            
              <li><a href="/2015/10/29/stream-processing-patterns-at-crunch.html">29 Oct 2015 at Crunch Conference</a></li>
            
              <li><a href="/2015/09/30/data-liberation-with-kafka-at-strata.html">30 Sep 2015 at Strata + Hadoop World</a></li>
            
              <li><a href="/2015/09/28/recurse-center-residence.html">28 Sep 2015 at Recurse Center</a></li>
            
            <li><a href="/talks.html">Full archive</a></li>
        </ul>
    </div>
</div>

            </div>
        </div>

        <hr class="divider" />

<div id="footer">
    <div class="wrapper">
        <p id="generator-link">
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/"
                style="float: left; padding: 0.3em 1em 0 0;"><img alt="Creative Commons License"
                src="/images/creative-commons.png" width="88" height="31" /></a>
            Unless otherwise specified, all content on this site is licensed under a
            <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons
                Attribution 3.0 Unported License</a>.
            Theme borrowed from
            <span id="theme-link"><a href="http://carringtontheme.com" title="Carrington theme for WordPress">Carrington</a></span>,
            ported to <a href="https://github.com/mojombo/jekyll">Jekyll</a> by Martin Kleppmann.
        </p>
    </div>
</div>

<img src="https://www.lduhtrp.net/image-7658334-11260198" width="1" height="1" border="0"/>

    </div>

    <script type="text/javascript">
    var disqus_shortname = 'martinkl';
    var disqus_url = 'http://martin.kleppmann.com/2013/10/23/linkedin-intro-doing-the-impossible-on-ios.html';
    var disqus_identifier = disqus_url;

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

    <!-- Google Analytics -->
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-7958895-1");
        pageTracker._trackPageview();
    } catch (err) {}
</script>

<!-- Twitter -->
<script>
!function (d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0],
        p = /^http:/.test(d.location) ? 'http' : 'https';
    if (!d.getElementById(id)) {
        js = d.createElement(s);
        js.id = id;
        js.src = p + "://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js,fjs);
    }
}(document,"script","twitter-wjs");
</script>

</body>
</html>
